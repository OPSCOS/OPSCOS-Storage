WITH SERVICE_TYPES AS (
    SELECT DISTINCT
        LNP_RECORD_KEY,
        REGEXP_SUBSTR(EXTN_ATTRIBUTE_CHAR012, '[^,]+', 1, LEVEL) AS SERVICE_TYPE_CODE
    FROM PSC_LNP_RECORD
    WHERE LNP_RECORD_KEY = :P_LNP_RECORD_KEY
    CONNECT BY LEVEL <= REGEXP_COUNT(EXTN_ATTRIBUTE_CHAR012, ',') + 1
    AND PRIOR LNP_RECORD_KEY = LNP_RECORD_KEY
    AND PRIOR DBMS_RANDOM.VALUE IS NOT NULL  -- prevents infinite loop
)
SELECT 
    ST.LNP_RECORD_KEY,
    ST.SERVICE_TYPE_CODE,
    FL.MEANING
FROM SERVICE_TYPES ST
JOIN FND_LOOKUPS FL 
    ON ST.SERVICE_TYPE_CODE = FL.LOOKUP_CODE
WHERE FL.ENABLED_FLAG = 'Y'
  AND FL.LOOKUP_TYPE = 'PSC_PLAN_APPL_TYPE'
