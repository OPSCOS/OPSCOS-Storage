SELECT
A.LNP_RECORD_KEY,
A.LNP_RECORD_ID,
A.EXTN_ATTRIBUTE_CHAR010 AS REQUESTED_USE,

A.EXTN_ATTRIBUTE_CHAR012 AS APPLICATION_TYPES,


CASE 
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 1 THEN 'January'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 2 THEN 'February'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 3 THEN 'March'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 4 THEN 'April'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 5 THEN 'May'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 6 THEN 'June'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 7 THEN 'July'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 8 THEN 'August'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 9 THEN 'September'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 10 THEN 'October'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 11 THEN 'November'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 12 THEN 'December'
        ELSE NULL 
    END AS CURRENT_MONTH, 

 EXTRACT(DAY FROM CURRENT_DATE) AS CURRENT_DAY, 

   EXTRACT(YEAR FROM CURRENT_DATE) AS CURRENT_YEAR,
    
    

A.PERSON_NAME AS APPLICANT,
A.ADDRESS1 AS APPLICANT_ADDRESS1,
A.CITY ||' '|| A.STATE ||' '|| A.POSTAL_CODE AS APPLICANT_ADDRESS2,
A.ORGANIZATION_NAME AS APPLICANT_BUS_NAME,
A.EMAIL_ADDRESS1 AS APPLICANT_EMAIL,


 CASE 
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 1 THEN 'January'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 2 THEN 'February'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 3 THEN 'March'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 4 THEN 'April'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 5 THEN 'May'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 6 THEN 'June'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 7 THEN 'July'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 8 THEN 'August'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 9 THEN 'September'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 10 THEN 'October'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 11 THEN 'November'
        WHEN EXTRACT(MONTH FROM CURRENT_DATE) = 12 THEN 'December'
        ELSE NULL 
    END || ' ' ||
    EXTRACT(DAY FROM CURRENT_DATE) || ', ' ||
    EXTRACT(YEAR FROM CURRENT_DATE) AS CURRENT_DATE,
    
    
CASE 
	WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'NO' THEN B.EXTN_ATTRIBUTE_CHAR006	
	WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'YES' THEN 
    			CASE 
                	WHEN A.EXTN_ATTRIBUTE_CHAR005	= 'NO' THEN B.EXTN_ATTRIBUTE_CHAR006
                    WHEN A.EXTN_ATTRIBUTE_CHAR005	= 'YES' THEN A.PERSON_NAME
                    ELSE NULL
               END
               
ELSE NULL
END AS OWNER_NAME,

CASE 
	WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'NO' THEN 
    		CASE 
                WHEN INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') > 0 
                THEN SUBSTR(B.EXTN_ATTRIBUTE_CHAR007, 1, INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') - 1)
                ELSE B.EXTN_ATTRIBUTE_CHAR007
            END
	WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'YES' THEN  
    		 CASE 
                WHEN A.EXTN_ATTRIBUTE_CHAR005 = 'NO' THEN 
                    CASE 
                        WHEN INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') > 0 
                        THEN SUBSTR(B.EXTN_ATTRIBUTE_CHAR007, 1, INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') - 1)
                        ELSE B.EXTN_ATTRIBUTE_CHAR007
                    END
                WHEN A.EXTN_ATTRIBUTE_CHAR005 = 'YES' THEN A.ADDRESS1
                ELSE NULL
            END
     ELSE NULL
    END AS OWN_FIRST_LINE,
    
CASE 
	WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'NO' THEN 
    		CASE 
                WHEN INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') > 0 
                THEN SUBSTR(B.EXTN_ATTRIBUTE_CHAR007, INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD'))
                ELSE B.EXTN_ATTRIBUTE_CHAR007
            END
    WHEN A.EXTN_ATTRIBUTE_CHAR003 = 'YES' THEN 
    		CASE 
                WHEN A.EXTN_ATTRIBUTE_CHAR005 = 'NO' THEN 
                    CASE 
                        WHEN INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD') > 0 
                        THEN SUBSTR(B.EXTN_ATTRIBUTE_CHAR007, INSTR(UPPER(B.EXTN_ATTRIBUTE_CHAR007), 'STAMFORD'))
                        ELSE B.EXTN_ATTRIBUTE_CHAR007
                    END
                WHEN A.EXTN_ATTRIBUTE_CHAR005 = 'YES' THEN A.CITY || ', ' || A.STATE || ' ' || A.POSTAL_CODE
                ELSE NULL
            END
            
      ELSE NULL
 END AS OWN_SECOND_LINE,
 
C.EXTN_ATTRIBUTE_CHAR003 AS CO_APPLICANT_NAME
    
    
    

FROM PSC_LNP_RECORD A
LEFT JOIN PSC_TS_GRID_RECORD B
  ON A.LNP_RECORD_KEY = B.EXTN_ATTRIBUTE_NUMBER001 
  AND B.ATTRIBUTE_CATEGORY = 'PZ1SitePlan1g1_c'
LEFT JOIN PSC_TS_GRID_RECORD C
  ON A.LNP_RECORD_KEY = C.EXTN_ATTRIBUTE_NUMBER001 
  AND C.ATTRIBUTE_CATEGORY = 'PZ1SitePlan1g3_c'
WHERE A.LNP_RECORD_KEY = :P_LNP_RECORD_KEY
